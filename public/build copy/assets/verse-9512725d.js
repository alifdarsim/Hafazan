import{a as k}from"./axios-4a70c6fc.js";let T={},L,S,V=[],B=10,w=!1,E=!1,A=!1;const a={getVerses:(e,r,t,s,c,l,m,f)=>{let g={words:!0,translation_fields:"resource_name,language_id",per_page:t,fields:"text_uthmani,chapter_id,hizb_number,text_imlaei_simple",translations:c,reciter:s,word_translation_language:l,page:r+1,word_fields:"verse_key,verse_id,page_number,location,text_uthmani,qpc_uthmani_hafs",mushaf:m};const y=JSON.stringify(g);T[y]||(T[y]=!0,$.ajax({url:"https://api.qurancdn.com/api/qdc/verses/by_chapter/"+e,type:"get",data:g,dataType:"json",success:function(u){f(u)}}))},downloadVerses:()=>{V.filter((r,t)=>t%1===0).forEach(r=>{let t=(r-1)/B;t=Math.round(t),a.getVerses(L,t,B,7,S,"en",5,function(s){s.verses.filter(l=>l.words).forEach(function(l){let m=l.verse_key,f=l.words,g=f.map(d=>d.text),y=f.map(d=>d.char_type_name),u=l.translations[0].text;u=u.replace(/<sup[^>]*>.*?<\/sup>/g,""),a.setText(m,g,y,u)})})})},setText:(e,r,t,s)=>{const c=document.getElementById(e);c.querySelectorAll(".\\!hidden").forEach(g=>g.classList.remove("!hidden")),c.querySelectorAll(".skeleton").forEach(g=>g.classList.add("!hidden"));const f=c.querySelector(".text-container");f.innerHTML="",r.forEach((g,y)=>{if(t[y]==="word"){const u=document.createElement("span");u.className="words",u.textContent=g;const d=document.createElement("button");d.className="word-holder",d.type="button",d.setAttribute("word",y+1),d.appendChild(u),f.append(d)}else{const u=document.createElement("span");u.className="words",u.textContent=g;const d=document.createElement("button");d.className="cursor-default",d.appendChild(u),f.append(d)}}),a.setTranslation(e,s)},setTranslation:(e,r)=>{const s=document.getElementById(e).querySelector(".translation-container");s.innerHTML=r},renderingVerses:()=>{const e=document.querySelectorAll(".card[render='false']"),r=new IntersectionObserver(t=>{t.forEach(s=>{if(s.isIntersecting&&s.target.getAttribute("render")==="false"){s.target.id;let c=s.target.getAttribute("verse");c=c-5,c<1&&(c=0),V.push(c),s.target.setAttribute("render","true"),a.downloadVerses()}})});e.forEach(t=>{r.observe(t)})},init:(e,r)=>{L=e,S=r,a.renderingVerses(),a.setPlayClickListener()},reInit:(e,r)=>{T={},L=e,S=r,document.querySelectorAll(".card[render='true']").forEach(s=>{s.setAttribute("render","false")}),a.renderingVerses()},setIsVerseScroll:e=>{w=e,localStorage.setItem("scrollToVerse",e)},setIsVerseHighlighted:e=>{E=e,localStorage.setItem("highlightVerse",e)},setIsWordHighlighted:e=>{A=e,localStorage.setItem("highlightWord",e)},setRecitedWord:(e,r)=>{if(A==="false")return;const t=document.getElementById(e);if(document.querySelectorAll(".word-highlight").forEach(l=>l.classList.remove("word-highlight")),r===null)return;t.querySelectorAll(".word-holder").forEach(l=>{l.classList.remove("word-highlight"),l.getAttribute("word")===r.toString()&&l.classList.add("word-highlight")})},setRecitedVerse:e=>{a.clearHighlights(),e!==null&&a.addVerseHighlight(e)},clearHighlights:()=>{document.querySelectorAll(".verse-highlight").forEach(t=>{t.classList.remove("verse-highlight")}),document.querySelectorAll(".word-highlight").forEach(t=>{t.classList.remove("word-highlight")})},addVerseHighlight:e=>{if(console.log(E),E==="false")return;document.getElementById(e).classList.add("verse-highlight")},setPlayClickListener:()=>{document.querySelectorAll(".verse-play-button").forEach(r=>{r.addEventListener("click",function(){const t=r.getAttribute("verse-key");i.playVerse(t)})})},scrollToVerse:e=>{if(w==="false")return;document.getElementById(e).scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}},n=document.querySelector("#quranAudio");let v=null,q=null,h=null,x=null;const i={currentVerse:h,setAudioInfo:async function(e,r){try{return v=(await k.get(`https://api.qurancdn.com/api/qdc/audio/reciters/${e}/audio_files?chapter=${r}&segments=true`)).data.audio_files[0],n.src=v.audio_url,v}catch(t){throw t}},getAudioUrl:()=>n.src,playVerse:(e=null)=>{e===null&&(e=h),n.pause();let r=v.verse_timings.find(s=>s.verse_key===e),t=0;r!==void 0&&(t=r.timestamp_from),o.showPlayer(),o.setAudioPlayerToPlay(),i.play(t)},pause:()=>{n.pause(),o.setAudioPlayerToPause()},isPaused:()=>n.paused,play:(e=null,r=null)=>{console.log("audio is start"),clearTimeout(q),o.showPlayer(),e!==null&&(n.currentTime=e/1e3),r!==null&&(q=setTimeout(()=>{n.pause()},r-e)),n.play(),i.setSpeed(localStorage.getItem("audioSpeed")),i.getOnVerseChangedListener(()=>{a.clearHighlights(),a.addVerseHighlight(h),a.scrollToVerse(h)}),i.getOnWordChangedListener((t,s)=>{a.setRecitedWord(h,s)}),i.getTimeUpdateListener(()=>{o.setCurrentTime(i.formatTime(n.currentTime)),o.setAudioProgress(n.currentTime/n.duration*100)}),o.setDuration(i.formatTime(n.duration)),i.setOnEndedListener(()=>{o.setAudioPlayerToPause(),a.clearHighlights()})},getOnVerseChangedListener:e=>{n.addEventListener("timeupdate",()=>{if(n.currentTime===0)return;let t=v.verse_timings.find(s=>s.timestamp_from<=n.currentTime*1e3+1&&s.timestamp_to>=n.currentTime*1e3+1);t!==void 0&&t.verse_key!==h&&(h=t.verse_key,e(t.verse_key))})},getOnWordChangedListener:e=>{n.addEventListener("timeupdate",()=>{if(n.currentTime===0)return;let t=v.verse_timings.find(m=>m.timestamp_from<=n.currentTime*1e3+1&&m.timestamp_to>=n.currentTime*1e3+1);if(t===void 0)return;let s=t.verse_key,l=t.segments.find(m=>m[1]<=n.currentTime*1e3+1&&m[2]>=n.currentTime*1e3+1);l!==void 0&&l[0]!==x&&(x=l[0],e(s,l[0]))})},getTimeUpdateListener:e=>{n.addEventListener("timeupdate",()=>{e(n.currentTime)})},nextVerse:()=>{console.log(h),i.playVerse(i.incrementKey(h,!0))},previousVerse:()=>{console.log(h),i.playVerse(i.incrementKey(h,!1))},incrementKey:(e,r)=>{const[t,s]=e.split(":").map(Number);return r?`${t}:${s+1}`:`${t}:${s-1}`},formatTime:e=>{const r=Math.floor(e/60),t=Math.floor(e%60);return`${r}:${t<10?"0"+t:t}`},setOnEndedListener:e=>{n.addEventListener("ended",()=>{e()})},setSpeed:e=>{n.playbackRate=e}},p=document.querySelector("#audioPlayer"),_=p.querySelector("#playButton"),b=p.querySelector("#seekBar"),P=document.querySelector("#reciteButton"),I=p.querySelector("#durationDisplay"),H=p.querySelector("#currentTimeDisplay"),o={init:function(e,r){i.setAudioInfo(e,r).then(t=>{o.setPlayButton(),o.setCloseButton(),o.setNextButton(),o.setPreviousButton(),o.setReciteButton(),o.setSeekBar(),o.setOption()})},setPlayButton:()=>{_.addEventListener("click",function(){i.isPaused()?(console.log("audio is paused"),o.setAudioPlayerToPlay(),i.play()):(console.log("audio is playing"),o.setAudioPlayerToPause(),i.pause())})},setCloseButton:()=>{p.querySelector("#closeButton").addEventListener("click",function(){o.hide(),i.pause(),a.clearHighlights()})},setNextButton:()=>{p.querySelector("#nextButton").addEventListener("click",function(){console.log("next button clicked"),i.nextVerse()})},setPreviousButton:()=>{p.querySelector("#previousButton").addEventListener("click",function(){i.previousVerse()})},hide:()=>{p.classList.add("!hidden"),i.pause()},showPlayer:()=>{p.classList.remove("!hidden")},setAudioPlayerToPlay:()=>{_.innerHTML='<i class="fas fa-pause text-white text-lg"></i>',_.classList.add("bg-teal-500"),P.innerHTML='<i class="fas fa-pause"></i><span class="ml-2">Recite Surah</span>'},setAudioPlayerToPause:()=>{_.innerHTML='<i class="fas fa-play text-lg"></i>',_.classList.remove("bg-teal-500"),P.innerHTML='<i class="fas fa-play"></i><span class="ml-2">Recite Surah</span>'},setReciteButton:()=>{P.addEventListener("click",()=>{i.isPaused()?(i.play(),o.setAudioPlayerToPlay()):(i.pause(),o.setAudioPlayerToPause())})},setSeekBar:()=>{b.addEventListener("input",function(){i.currentTime=0})},setAudioProgress:e=>{b.value=e},setDuration:e=>{I.innerHTML=e},setCurrentTime:e=>{H.innerHTML=e},setOption:()=>{localStorage.getItem("scrollToVerse"),localStorage.getItem("highlightVerse"),localStorage.getItem("highlightWord")}};export{i as a,o as p,a as v};
